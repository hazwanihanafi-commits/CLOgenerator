<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SCLOG — Smart CLO Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body { background:#f7f9fc; }
    .card-box {
      background:#fff; border-radius:12px;
      padding:20px; box-shadow:0 5px 15px rgba(0,0,0,.05);
    }
  </style>
</head>
<body class="p-3">

<div class="container">

  <h3 class="mb-4 fw-bold">SCLOG — Smart CLO Generator</h3>

  <div class="card-box mb-4">
    <h5 class="fw-bold mb-3">IEG → PEO → PLO Mapping</h5>

    <div class="row g-3">

      <div class="col-md-4">
        <label class="form-label">IEG</label>
        <select id="ieg" class="form-select">
          <option value="">Select IEG</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">PEO</label>
        <select id="peo" class="form-select">
          <option value="">Select PEO</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">PLO</label>
        <select id="plo" class="form-select">
          <option value="">Select PLO</option>
        </select>
      </div>

    </div>
  </div>


  <div class="card-box mb-4">
    <h5 class="fw-bold mb-3">Bloom & Verb</h5>

    <div class="row g-3">

      <div class="col-md-4">
        <label class="form-label">Bloom Level</label>
        <select id="bloom" class="form-select">
          <option value="">Select Bloom</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Verb</label>
        <select id="verb" class="form-select">
          <option value="">Select Verb</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Content</label>
        <input id="content" type="text" class="form-control" placeholder="e.g., interpret ECG signals">
      </div>

    </div>
  </div>


  <div class="card-box mb-4">
    <h5 class="fw-bold mb-3">Auto-Filled Metadata</h5>

    <div class="row g-3">

      <div class="col-md-3">
        <label class="form-label">SC Code</label>
        <input id="sc_code" class="form-control" readonly>
      </div>

      <div class="col-md-3">
        <label class="form-label">SC Description</label>
        <input id="sc_desc" class="form-control" readonly>
      </div>

      <div class="col-md-3">
        <label class="form-label">VBE</label>
        <input id="vbe" class="form-control" readonly>
      </div>

      <div class="col-md-3">
        <label class="form-label">Domain</label>
        <input id="domain" class="form-control" readonly>
      </div>

      <div class="col-md-6">
        <label class="form-label">Condition</label>
        <input id="condition" class="form-control" readonly>
      </div>

      <div class="col-md-6">
        <label class="form-label">Criterion</label>
        <input id="criterion" class="form-control" readonly>
      </div>

    </div>
  </div>


  <div class="card-box mb-4">
    <h5 class="fw-bold mb-3">Generate CLO</h5>

    <button id="generate" class="btn btn-primary">Generate CLO</button>

    <div id="clo_block" class="mt-3" style="display:none;">
      <h6 class="fw-bold">Generated CLO</h6>
      <div id="clo_text" class="border rounded p-2 bg-light"></div>
    </div>
  </div>

</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* -------------------------
     1. LOAD IEG LIST
--------------------------*/
fetch("/api/mapping")
  .then(r => r.json())
  .then(data => {
      window.MAP = data;

      let iegSel = document.getElementById("ieg");
      data.IEGs.forEach(i => {
         let opt = new Option(i, i);
         iegSel.add(opt);
      });
  });

/* -------------------------
     2. IEG → PEO
--------------------------*/
document.getElementById("ieg").addEventListener("change", function() {
    let ieg = this.value;
    let peoSel = document.getElementById("peo");
    peoSel.innerHTML = '<option value="">Select PEO</option>';

    if (!ieg) return;

    fetch(`/api/get_peos/${ieg}`)
      .then(r => r.json())
      .then(list => {
         list.forEach(p => peoSel.add(new Option(p, p)));
      });
});


/* -------------------------
     3. PEO → PLO
--------------------------*/
document.getElementById("peo").addEventListener("change", function() {
    let peo = this.value;
    let ploSel = document.getElementById("plo");
    ploSel.innerHTML = '<option value="">Select PLO</option>';

    fetch(`/api/get_plos/${peo}`)
      .then(r => r.json())
      .then(list => {
         list.forEach(p => ploSel.add(new Option(p, p)));
      });
});


/* -------------------------
     4. PLO → Bloom
--------------------------*/
document.getElementById("plo").addEventListener("change", function() {
    let plo = this.value;
    let bloomSel = document.getElementById("bloom");
    bloomSel.innerHTML = '<option value="">Loading…</option>';

    fetch(`/api/get_blooms/${plo}?profile=sc`)
      .then(r => r.json())
      .then(list => {
         bloomSel.innerHTML = '<option value="">Select Bloom</option>';
         list.forEach(b => bloomSel.add(new Option(b, b)));
      });
});


/* -------------------------
     5. Bloom → Verbs
--------------------------*/
document.getElementById("bloom").addEventListener("change", function() {
    let bloom = this.value;
    let plo = document.getElementById("plo").value;

    fetch(`/api/get_verbs/${plo}/${bloom}?profile=sc`)
      .then(r => r.json())
      .then(list => {
         let verbSel = document.getElementById("verb");
         verbSel.innerHTML = '<option value="">Select Verb</option>';
         list.forEach(v => verbSel.add(new Option(v, v)));
      });

    /* Load Meta */
    fetch(`/api/get_meta/${plo}/${bloom}?profile=sc`)
      .then(r=>r.json())
      .then(m => {
         document.getElementById("sc_code").value = m.sc_code;
         document.getElementById("sc_desc").value = m.sc_desc;
         document.getElementById("vbe").value = m.vbe;
         document.getElementById("domain").value = m.domain;
         document.getElementById("condition").value = m.condition;
         document.getElementById("criterion").value = m.criterion;
      });
});


/* -------------------------
     6. GENERATE CLO
--------------------------*/
document.getElementById("generate").addEventListener("click", function() {

    let fd = new FormData();
    fd.append("profile", "sc");
    fd.append("plo", document.getElementById("plo").value);
    fd.append("bloom", document.getElementById("bloom").value);
    fd.append("verb", document.getElementById("verb").value);
    fd.append("content", document.getElementById("content").value);
    fd.append("course", "");
    fd.append("cw", "");
    fd.append("level", "Degree");

    fetch("/generate", {method:"POST", body:fd})
      .then(r => r.json())
      .then(res => {
        document.getElementById("clo_text").innerText = res.clo;
        document.getElementById("clo_block").style.display = "block";
      });
});
</script>

</body>
</html>
