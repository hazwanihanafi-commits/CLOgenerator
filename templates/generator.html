<!doctype html>
<html lang="en">
<head>
  <!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HMBYNXRLBE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HMBYNXRLBE');

  // Custom event helper
  function logEvent(name, data={}) {
    gtag('event', name, data);
  }
</script>

  <meta charset="utf-8" />
  <title>SCLOG — Smart Course Learning Outcome Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --usm-purple: #6d28d9;
      --usm-purple-light: #a78bfa;
      --usm-bg: #f5f3ff;
      --card-bg: #ffffff;
      --muted: #6c6480;
      --text-dark: #292545;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --border: rgba(109,40,217,0.16);
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing: antialiased;
    }

    body[data-theme="light"] {
      background: var(--usm-bg);
      color: var(--text-dark);
    }

    body[data-theme="dark"] {
      background: radial-gradient(circle at top, #0f0b1b, #1d1230);
      color: #f4edff;
    }

    .app-wrap {
      max-width: 1400px;
      margin: 10px auto 40px;
      padding: 12px;
    }

    .card-box {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: box-shadow .18s ease, transform .18s ease;
    }

    body[data-theme="dark"] .card-box {
      background: #231735;
      border-color: rgba(255,255,255,0.08);
      box-shadow: 0 14px 40px rgba(0,0,0,.6);
    }

    .card-box:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 40px rgba(109,40,217,0.18);
    }

    .header-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
      font-size: 1.25rem;
      background: linear-gradient(90deg,var(--usm-purple),var(--usm-purple-light));
      -webkit-background-clip: text;
      color: transparent !important;
    }

    .small-muted {
      font-size: .94rem;
      color: var(--muted);
    }

    body[data-theme="dark"] .small-muted {
      color: #c7bcf3;
    }

    .sidebar-title {
      font-weight: 700;
      margin-bottom: 2px;
    }

    .form-select,
    .form-control {
      border-radius: 12px !important;
      padding: 9px 12px !important;
      border: 1px solid rgba(15,23,42,0.08) !important;
      background: #faf7ff;
      font-size: .95rem;
    }

    body[data-theme="dark"] .form-select,
    body[data-theme="dark"] .form-control {
      background: #32234f;
      color: #f4edff;
      border-color: rgba(255,255,255,0.08) !important;
    }

    .form-select:focus,
    .form-control:focus {
      box-shadow: 0 0 0 5px rgba(167,139,250,0.3) !important;
      border-color: var(--usm-purple) !important;
    }

    .logic-box {
      background: #f7f2ff;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: .9rem;
      min-height: 52px;
    }

    body[data-theme="dark"] .logic-box {
      background: #32234f;
    }

    .btn {
      border-radius: 12px;
      font-weight: 600;
    }

    .btn-primary {
      background: linear-gradient(90deg,var(--usm-purple),var(--usm-purple-light));
      border: none;
    }

    .btn-outline-secondary {
      border-color: var(--usm-purple);
      color: var(--usm-purple);
    }

    .btn-outline-secondary:hover {
      background: var(--usm-purple);
      color: #fff;
    }

    .btn-success {
      background: #22c55e;
      border: none;
    }

    .nav-tabs {
      border-bottom: none;
      overflow-x: auto;
      white-space: nowrap;
    }

    .nav-tabs .nav-link {
      border: none !important;
      margin-right: 6px;
      border-radius: 10px;
      padding: 7px 12px;
      background: #f3eefe;
      color: var(--usm-purple);
      font-weight: 500;
    }

    .nav-tabs .nav-link.active {
      background: var(--usm-purple);
      color: #fff !important;
      font-weight: 700;
    }

    body[data-theme="dark"] .nav-tabs .nav-link {
      background: #3a2957;
      color: #e8deff;
    }
    body[data-theme="dark"] .nav-tabs .nav-link.active {
      background: #7c3aed;
    }

    #content_suggestions button {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: .85rem;
      margin: 0 6px 6px 0;
      background: #f3eefe;
      border: 1px solid rgba(109,40,217,0.2);
      color: var(--usm-purple);
    }

    body[data-theme="dark"] #content_suggestions button {
      background: #3a2957;
      color: #efe6ff;
      border-color: rgba(255,255,255,0.06);
    }

    .download-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    footer {
      text-align: center;
      font-size: .85rem;
      padding: 10px 0;
      color: #6b6480;
    }

    body[data-theme="dark"] footer {
      color: #d9cffd;
    }

    @media (max-width: 991px) {
      .sidebar-col { margin-bottom: 14px; }
    }

    @media (max-width: 576px) {
      .card-box { padding: 12px; border-radius: 12px; }
      .brand { font-size: 1.05rem; }
      .btn { font-size: .88rem; padding: 7px 10px; }
    }
  </style>
</head>
<body data-theme="light">
  <div class="app-wrap">
    <!-- HEADER -->
    <div class="card-box header-card">
      <div>
        <div class="brand"><i class="bi bi-stars"></i> SCLOG</div>
        <div class="small-muted">Smart Course Learning Outcome Generator</div>
      </div>
      <button id="darkToggle" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-moon"></i> Dark
      </button>
    </div>

    <div class="row g-3">
      <!-- SIDEBAR: mapping & profile -->
      <div class="col-lg-4 sidebar-col">
        <div class="card-box mb-3">
          <div class="sidebar-title">Smart CLO Generator — Logic & Mapping</div>
          <div class="small-muted mb-3">Configure profile and mapping before generating CLOs.</div>

          <!-- Profile -->
          <label class="form-label small-muted">Academic profile</label>
          <select id="profile" class="form-select mb-2">
            <option value="health">Medical & Health</option>
            <option value="sc" selected>Computer Science & IT</option>
            <option value="eng">Engineering & Technology</option>
            <option value="socs">Social Sciences</option>
            <option value="edu">Education</option>
            <option value="bus">Business & Management</option>
            <option value="arts">Arts & Humanities</option>
          </select>

          <!-- Level -->
          <label class="form-label small-muted">Level</label>
          <select id="level" class="form-select mb-3">
            <option>Diploma</option>
            <option selected>Degree</option>
            <option>Master</option>
            <option>PhD</option>
          </select>

          <hr>

          <!-- IEG / PEO / WHY -->
          <label class="form-label small-muted">Select IEG</label>
          <select id="ieg" class="form-select mb-2">
            <option value="">Select IEG</option>
          </select>

          <label class="form-label small-muted mt-2">Mapped PEO</label>
          <select id="peo" class="form-select mb-2">
            <option value="">Select PEO</option>
          </select>

          <div class="form-label small-muted mt-2 mb-1">Why this IEG → PEO?</div>
          <div id="ieg_peo_logic" class="logic-box">—</div>

          <!-- PLO + statements -->
          <div class="form-label small-muted mt-3">PLO for selected PEO</div>
          <select id="plo" class="form-select mb-2">
            <option value="">Select PLO</option>
          </select>

          <div class="form-label small-muted mt-2 mb-1">Why this PEO → PLO?</div>
          <div id="peo_plo_logic" class="logic-box">—</div>

          <div class="mt-3 small-muted">
            <div><strong>PEO:</strong> <span id="peo_statement">—</span></div>
            <div><strong>PLO:</strong> <span id="plo_statement">—</span></div>
            <div><strong>Indicator:</strong> <span id="plo_indicator">—</span></div>
          </div>
        </div>
      </div>

      <!-- MAIN BUILDER -->
      <div class="col-lg-8">
        <div class="card-box">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <h5 class="mb-0">Smart CLO Builder</h5>
              <div class="small-muted">Create measurable course learning outcomes quickly</div>
            </div>
          </div>

          <!-- Tabs -->
          <ul class="nav nav-tabs" id="tabNav" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#builder">Builder</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#variantsTab">Variants</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#assessmentTab">Assessment</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#historyTab">History</button></li>
          </ul>

          <div class="tab-content mt-3">
            <!-- BUILDER TAB -->
            <div class="tab-pane fade show active" id="builder">
              <div class="row g-3">
                <div class="col-lg-7">
                  <label class="form-label small-muted">Bloom</label>
                  <select id="bloom" class="form-select mb-2">
                    <option value="">Select Bloom</option>
                  </select>

                  <label class="form-label small-muted">Verb</label>
                  <select id="verb" class="form-select mb-2">
                    <option value="">Select Verb</option>
                  </select>

                  <label class="form-label small-muted">Field (topic area)</label>
                  <select id="field" class="form-select mb-2">
                    <option value="">— Select Field —</option>
                    <option>Computer Science</option>
                    <option>Medical & Health</option>
                    <option>Engineering</option>
                    <option>Social Sciences</option>
                    <option>Education</option>
                    <option>Business</option>
                    <option>Arts & Humanities</option>
                  </select>

                  <div class="small-muted mb-1">Selecting a field suggests content topics below.</div>
                  <div id="content_suggestions" class="mb-2"></div>

                  <label class="form-label small-muted">Content (topic / object)</label>
                  <input id="content" class="form-control" placeholder="e.g., interpret ECG waveforms"/>

                  <div class="mt-3 d-flex align-items-center gap-2">
                    <button id="generateBtn" class="btn btn-primary">
                      <i class="bi bi-magic me-1"></i> Generate CLO
                    </button>
                    <button id="copyBtn" class="btn btn-outline-secondary">
                      <i class="bi bi-clipboard"></i> Copy
                    </button>
                    <span id="busy" class="small-muted" style="display:none;">Generating…</span>
                  </div>

                  <div id="cloCard" class="card-box mt-3" style="display:none;">
                    <h6 class="mb-2">Generated CLO</h6>
                    <div id="clo_text" class="fw-semibold" style="line-height:1.4;"></div>

                    <button id="toggleVariants" class="btn btn-sm btn-outline-secondary mt-3">
                      Show variants
                    </button>
                    <div id="variantsPanel" style="display:none;" class="mt-2"></div>

                    <!-- Downloads under builder (your choice A) -->
                    <div class="download-row">
                      <button id="downloadBtn" class="btn btn-success">
                        <i class="bi bi-download me-1"></i> Download CLO
                      </button>
                      <button id="downloadRubricBtn" class="btn btn-outline-secondary">
                        <i class="bi bi-file-earmark-text me-1"></i> Download Rubric
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Metadata -->
                <div class="col-lg-5">
                  <div class="card-box">
                    <div class="small-muted mb-2">Mapping metadata</div>
                    <p><strong>SC Code:</strong><br><span id="sc_code" class="small-muted">—</span></p>
                    <p><strong>SC Description:</strong><br><span id="sc_desc" class="small-muted">—</span></p>
                    <p><strong>VBE:</strong><br><span id="vbe" class="small-muted">—</span></p>
                    <p><strong>Domain:</strong><br><span id="domain" class="small-muted">—</span></p>
                    <p><strong>Condition:</strong><br><span id="condition" class="small-muted">—</span></p>
                    <p><strong>Criterion:</strong><br><span id="criterion" class="small-muted">—</span></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- VARIANTS TAB -->
            <div class="tab-pane fade" id="variantsTab">
              <div id="variants_list" class="small-muted">Variants will appear after generating a CLO.</div>
            </div>

            <!-- ASSESSMENT TAB -->
            <div class="tab-pane fade" id="assessmentTab">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="card-box">
                    <h6>Assessment methods</h6>
                    <div id="assess_list" class="small-muted">—</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card-box">
                    <h6>Suggested evidence</h6>
                    <div id="evidence_list" class="small-muted">—</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- HISTORY TAB (placeholder) -->
            <div class="tab-pane fade" id="historyTab">
              <div class="card-box">
                <h6>Recent generation</h6>
                <div id="history_list" class="small-muted">
                  Server-side history not enabled in this demo.
                </div>
              </div>
            </div>
          </div>
        </div>

        <footer class="mt-3">
          © 2025 • Assoc Prof Dr Hazwani Ahmad Yusof @ Hanafi • Universiti Sains Malaysia (USM)
        </footer>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const $ = id => document.getElementById(id);

    const profileSel = $('profile');
    const levelSel   = $('level');
    const iegSel     = $('ieg');
    const peoSel     = $('peo');
    const ploSel     = $('plo');
    const bloomSel   = $('bloom');
    const verbSel    = $('verb');
    const fieldSel   = $('field');
    const contentInput = $('content');

    const iegLogicBox  = $('ieg_peo_logic');
    const peoPloLogicBox = $('peo_plo_logic');

    const peoStatementEl = $('peo_statement');
    const ploStatementEl = $('plo_statement');
    const ploIndicatorEl = $('plo_indicator');

    const scCodeEl = $('sc_code');
    const scDescEl = $('sc_desc');
    const vbeEl    = $('vbe');
    const domainEl = $('domain');
    const conditionEl = $('condition');
    const criterionEl = $('criterion');

    const cloCard = $('cloCard');
    const cloText = $('clo_text');
    const variantsPanel = $('variantsPanel');
    const variantsTabList = $('variants_list');

    const assessList = $('assess_list');
    const evidenceList = $('evidence_list');

    const generateBtn = $('generateBtn');
    const copyBtn = $('copyBtn');
    const busyEl = $('busy');
    const toggleVariantsBtn = $('toggleVariants');
    const downloadBtn = $('downloadBtn');
    const downloadRubricBtn = $('downloadRubricBtn');
    const darkToggle = $('darkToggle');
    const contentSuggestionsEl = $('content_suggestions');

    let MAP = {};
    let LAST_CLO = null;

    // Dark mode toggle
    darkToggle.addEventListener('click', () => {
      const curr = document.body.getAttribute('data-theme') || 'light';
      const next = curr === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', next);
      darkToggle.innerHTML =
        next === 'dark'
          ? '<i class="bi bi-sun"></i> Light'
          : '<i class="bi bi-moon"></i> Dark';
    });

    // Load mapping on start
    async function loadMapping(){
      try{
        const res = await fetch('/api/mapping');
        MAP = await res.json();
        iegSel.innerHTML = '<option value="">Select IEG</option>';
        (MAP.IEGs || []).forEach(i => iegSel.add(new Option(i, i)));
      }catch(e){
        console.error('mapping', e);
      }
    }

    // IEG -> PEO + why
    iegSel.addEventListener('change', async () => {
      const ieg = iegSel.value;
      peoSel.innerHTML = '<option value="">Select PEO</option>';
      ploSel.innerHTML = '<option value="">Select PLO</option>';
      iegLogicBox.textContent = '—';
      peoPloLogicBox.textContent = '—';
      peoStatementEl.textContent = '—';
      ploStatementEl.textContent = '—';
      ploIndicatorEl.textContent = '—';

      if (!ieg) return;

      try {
        const res = await fetch(`/api/get_peos/${encodeURIComponent(ieg)}`);
        const peos = await res.json();
        peoSel.innerHTML = '<option value="">Select PEO</option>';
        (peos || []).forEach(p => peoSel.add(new Option(p, p)));
      } catch (e) {
        console.error(e);
      }

      try {
        const logicRes = await fetch(`/api/logic/ieg_peo/${encodeURIComponent(ieg)}`);
        const txt = await logicRes.text();
        iegLogicBox.textContent = txt && txt.trim() ? txt : 'No logic explanation available.';
      } catch (e) {
        console.error(e);
        iegLogicBox.textContent = 'Logic unavailable.';
      }
    });

    // PEO -> PLO + PEO statement
    peoSel.addEventListener('change', async () => {
      const peo = peoSel.value;
      ploSel.innerHTML = '<option value="">Select PLO</option>';
      peoPloLogicBox.textContent = '—';
      ploStatementEl.textContent = '—';
      ploIndicatorEl.textContent = '—';

      if (!peo) return;

      try {
        const res = await fetch(`/api/get_plos/${encodeURIComponent(peo)}`);
        const plos = await res.json();
        ploSel.innerHTML = '<option value="">Select PLO</option>';
        (plos || []).forEach(p => ploSel.add(new Option(p, p)));
      } catch (e) {
        console.error(e);
      }

      // PEO statement
      try {
        const level = levelSel.value || 'Degree';
        const stmtRes = await fetch(`/api/get_statement/${encodeURIComponent(level)}/PEO/${encodeURIComponent(peo)}`);
        const stmt = await stmtRes.json();
        peoStatementEl.textContent = stmt || '—';
      } catch (e) {
        console.error(e);
      }
    });

    // PLO change -> PEO→PLO logic + blooms + PLO stmt + indicator
    ploSel.addEventListener('change', async () => {
      const plo = ploSel.value;
      const peo = peoSel.value;

      bloomSel.innerHTML = '<option value="">Select Bloom</option>';
      peoPloLogicBox.textContent = '—';
      ploStatementEl.textContent = '—';
      ploIndicatorEl.textContent = '—';

      if (!plo || !peo) return;

      // why PEO -> PLO
      try {
        const logicRes = await fetch(`/api/logic/peo_plo/${encodeURIComponent(peo)}/${encodeURIComponent(plo)}`);
        const txt = await logicRes.text();
        peoPloLogicBox.textContent = txt && txt.trim() ? txt : 'No logic explanation available.';
      } catch (e) {
        console.error(e);
        peoPloLogicBox.textContent = 'Logic unavailable.';
      }

      // blooms
      try{
        const res = await fetch(`/api/get_blooms/${encodeURIComponent(plo)}?profile=${encodeURIComponent(profileSel.value)}`);
        const blooms = await res.json();
        bloomSel.innerHTML = '<option value="">Select Bloom</option>';
        (blooms || []).forEach(b => bloomSel.add(new Option(b, b)));
      }catch(e){
        console.error(e);
        bloomSel.innerHTML = '<option value="">Error</option>';
      }

      // PLO statement
      try {
        const level = levelSel.value || 'Degree';
        const stmtRes = await fetch(`/api/get_statement/${encodeURIComponent(level)}/PLO/${encodeURIComponent(plo)}`);
        const stmt = await stmtRes.json();
        ploStatementEl.textContent = stmt || '—';
      } catch (e) {
        console.error(e);
      }

      // Indicator
      try {
        ploIndicatorEl.textContent =
          (MAP.PLOIndicators && MAP.PLOIndicators[plo]) || '—';
      } catch (e) {
        ploIndicatorEl.textContent = '—';
      }
    });

    // Bloom change -> verbs + meta
    bloomSel.addEventListener('change', async () => {
      const bloom = bloomSel.value;
      const plo = ploSel.value;
      if (!bloom || !plo) return;

      // verbs
      try {
        const vres = await fetch(
          `/api/get_verbs/${encodeURIComponent(plo)}/${encodeURIComponent(bloom)}?profile=${encodeURIComponent(profileSel.value)}`
        );
        const verbs = await vres.json();
        verbSel.innerHTML = '<option value="">Select Verb</option>';
        (verbs || []).forEach(v => verbSel.add(new Option(v, v)));
      } catch (e) {
        console.error(e);
        verbSel.innerHTML = '<option value="">Error</option>';
      }

      // meta
      try {
        const mres = await fetch(
          `/api/get_meta/${encodeURIComponent(plo)}/${encodeURIComponent(bloom)}?profile=${encodeURIComponent(profileSel.value)}`
        );
        const meta = await mres.json();
        scCodeEl.textContent = meta.sc_code || '—';
        scDescEl.textContent = meta.sc_desc || '—';
        vbeEl.textContent = meta.vbe || '—';
        domainEl.textContent = meta.domain || '—';
        conditionEl.textContent = meta.condition || '—';
        criterionEl.textContent = meta.criterion || '—';
      } catch (e) {
        console.error(e);
      }
    });

    // Field -> content suggestions
    fieldSel.addEventListener('change', async () => {
      const field = fieldSel.value;
      contentSuggestionsEl.innerHTML = '';
      if (!field) return;

      try {
        const res = await fetch(`/api/content/${encodeURIComponent(field)}`);
        const list = await res.json();
        (list || []).forEach(txt => {
          const btn = document.createElement('button');
          btn.className = 'btn btn-sm';
          btn.textContent = txt;
          btn.onclick = () => contentInput.value = txt;
          contentSuggestionsEl.appendChild(btn);
        });
      } catch (e) {
        console.error(e);
      }
    });

    // Generate CLO
    generateBtn.addEventListener('click', async () => {
      if (!ploSel.value || !bloomSel.value || !verbSel.value || !contentInput.value.trim()) {
        alert('Please fill PLO, Bloom, Verb and Content.');
        return;
      }
      busyEl.style.display = 'inline';
      generateBtn.disabled = true;

      const fd = new FormData();
      fd.append('profile', profileSel.value);
      fd.append('level', levelSel.value);
      fd.append('plo', ploSel.value);
      fd.append('bloom', bloomSel.value);
      fd.append('verb', verbSel.value);
      fd.append('content', contentInput.value);

      try {
        const res = await fetch('/generate', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('Server error');
        const data = await res.json();
        LAST_CLO = data;

        cloText.innerText = data.clo || '';
        cloCard.style.display = 'block';

        // variants inside builder panel
        variantsPanel.innerHTML = '';
        const opts = data.variants || data.clo_options || {};
        Object.entries(opts).forEach(([label, text]) => {
          const div = document.createElement('div');
          div.className = 'logic-box mb-2';
          div.style.cursor = 'pointer';
          div.innerHTML = `<strong>${label}</strong><div class="mt-1">${text}</div>`;
          div.onclick = () => { cloText.innerText = text; };
          variantsPanel.appendChild(div);
        });

        // variants tab
        variantsTabList.innerHTML = '';
        Object.entries(opts).forEach(([label, text]) => {
          const p = document.createElement('p');
          p.innerHTML = `<strong>${label}:</strong> ${text}`;
          variantsTabList.appendChild(p);
        });

        // assessment & evidence
        const assessments = data.assessments || [];
        assessList.innerHTML = assessments.length
          ? '<ul>' + assessments.map(a => `<li>${a}</li>`).join('') + '</ul>'
          : '—';

        const evidence = data.evidence || {};
        evidenceList.innerHTML = Object.keys(evidence).length
          ? Object.entries(evidence).map(([k, v]) => `<div><strong>${k}</strong>: ${v.join('; ')}</div>`).join('')
          : '—';

      } catch (e) {
        console.error(e);
        alert('Error generating CLO.');
      } finally {
        busyEl.style.display = 'none';
        generateBtn.disabled = false;
      }
    });

    // Toggle variants panel under CLO
    toggleVariantsBtn.addEventListener('click', () => {
      const hidden = variantsPanel.style.display === 'none' || variantsPanel.style.display === '';
      variantsPanel.style.display = hidden ? 'block' : 'none';
      toggleVariantsBtn.innerText = hidden ? 'Hide variants' : 'Show variants';
    });

    // Copy CLO
    copyBtn.addEventListener('click', async () => {
      if (!cloText.innerText) return;
      try {
        await navigator.clipboard.writeText(cloText.innerText);
        copyBtn.innerText = 'Copied!';
        setTimeout(() => copyBtn.innerHTML = '<i class="bi bi-clipboard"></i> Copy', 1200);
      } catch (e) {
        alert('Copy failed.');
      }
    });

    // Downloads
    downloadBtn.addEventListener('click', () => {
      window.location = '/download';
    });
    downloadRubricBtn.addEventListener('click', () => {
      window.location = '/download_rubric';
    });
// All your DOM references here
const profileSel = $('profile');
const levelSel = $('level');
const fieldSel = $('field');
const iegSel = $('ieg');
const peoSel = $('peo');
const ploSel = $('plo');
// etc...

// All your fetch logic, mapping logic, CLO generation logic here...

/* ---------------------------------------
   GOOGLE ANALYTICS EVENT TRACKING
---------------------------------------- */
profileSel.addEventListener('change', () => {
  logEvent('profile_select', { profile: profileSel.value });
});

levelSel.addEventListener('change', () => {
  logEvent('level_select', { level: levelSel.value });
});

fieldSel.addEventListener('change', () => {
  logEvent('field_select', { field: fieldSel.value });
});

iegSel.addEventListener('change', () => {
  logEvent('ieg_select', { ieg: iegSel.value });
});

peoSel.addEventListener('change', () => {
  logEvent('peo_select', { peo: peoSel.value });
});

ploSel.addEventListener('change', () => {
  logEvent('plo_select', { plo: ploSel.value });
});

bloomSel.addEventListener('change', () => {
  logEvent('bloom_select', { bloom: bloomSel.value });
});

verbSel.addEventListener('change', () => {
  logEvent('verb_select', { verb: verbSel.value });
});

generateBtn.addEventListener('click', () => {
  logEvent('generate_clo', {
    plo: ploSel.value,
    bloom: bloomSel.value,
    verb: verbSel.value
  });
});

copyBtn.addEventListener('click', () => {
  logEvent('copy_clo');
});

downloadBtn.addEventListener('click', () => {
  logEvent('download_clo');
});

downloadRubricBtn.addEventListener('click', () => {
  logEvent('download_rubric');
});

document.querySelectorAll('#tabNav .nav-link').forEach(tab => {
  tab.addEventListener('click', () => {
    logEvent('tab_click', { tab: tab.textContent.trim() });
  });
});

    // Init
    (function init(){
      loadMapping();
    })();
  </script>
</body>
</html>
