<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SCLOG Smart Course Learning Outcome Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root{ --brand:#5a2ca0; --ink:#3b2f5b; --soft:#f7f7fb; }
    body{background:var(--soft);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .navbar-custom{background:var(--brand);color:#fff}
    .navbar-custom label,.navbar-custom .nav-link,.navbar-custom a{color:#fff!important}
    .card{border:0;border-radius:1rem;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .card-header{background:#fff;border-bottom:0;font-weight:600;display:flex;gap:.6rem;color:var(--ink)}
    .icon-badge{width:40px;height:40px;border-radius:10px;background:#ede6ff;color:var(--brand);display:inline-flex;align-items:center;justify-content:center}
    #cloPreviewText{font-size:1.1rem;font-weight:600;color:#1a1a80;line-height:1.6}
    .option{border:1px solid #e7e7f3;border-radius:10px;padding:12px;margin-top:8px;cursor:pointer}
    .option:hover{background:#fafaff}
    .active-option{border-color:#5a2ca0;box-shadow:0 0 0 2px rgba(90,44,160,.15)}
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-custom p-3">
    <div class="container d-flex justify-content-between align-items-center">
      <div class="text-white fw-bold">
        <i class="bi bi-stars me-2"></i> SCLOG Course Learning Outcome Generator
      </div>
      <div class="d-flex align-items-center">
        <label class="me-2 fw-semibold">Discipline:</label>
        <select id="profile" class="form-select form-select-sm">
          <option value="">Medical & Health Sciences</option>
          <option value="health">Medical & Health Sciences (explicit)</option>
          <option value="sc">Computer Science & IT</option>
          <option value="eng">Engineering & Technology</option>
          <option value="socs">Social Sciences</option>
          <option value="edu">Education</option>
          <option value="bus">Business & Management</option>
          <option value="arts">Arts & Humanities</option>
        </select>
      </div>
    </div>
  </nav>

  <main class="container my-4">

    <!-- Tabs -->
    <ul class="nav nav-pills mb-3">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tabGenerate">
          <i class="bi bi-pencil-square me-1"></i>Generate CLO
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#tabHistory">
          <i class="bi bi-table me-1"></i>History
        </button>
      </li>
    </ul>

    <div class="tab-content">

      <!-- GENERATE TAB -->
      <div class="tab-pane fade show active" id="tabGenerate">

        <form id="cloForm" method="POST">

          <input type="hidden" id="profileHidden" name="profile" value="{{ profile }}" />

          <div class="row g-3">

            <!-- COURSE + MAPPING -->
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header">
                  <span class="icon-badge"><i class="bi bi-journal-text"></i></span> Course & Mapping
                </div>
                <div class="card-body">
                  
                  <label class="form-label">Course Code / Name *</label>
                  <input name="course" class="form-control" required />

                  <label class="form-label mt-3">PLO *</label>
                  <select id="plo" name="plo" class="form-select" required>
                    <option value="" disabled selected>Select PLO</option>
                    {% for p in plos %}
                      <option value="{{ p }}">{{ p }}</option>
                    {% endfor %}
                  </select>

                  <div class="row mt-3">
                    <div class="col-md-4">
                      <label class="form-label">SC Code</label>
                      <input id="sc_code" class="form-control" readonly />
                    </div>
                    <div class="col-md-8">
                      <label class="form-label">SC Description</label>
                      <input id="sc_desc" class="form-control" readonly />
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label class="form-label">VBE</label>
                      <input id="vbe" class="form-control" readonly />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Domain</label>
                      <input id="domain" class="form-control" readonly />
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <!-- BLOOM + VERB -->
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header">
                  <span class="icon-badge"><i class="bi bi-layers"></i></span> Bloom & Verbs
                </div>
                <div class="card-body">

                  <label class="form-label">Bloom Level *</label>
                  <select id="bloom" name="bloom" class="form-select" required></select>

                  <label class="form-label mt-3">Verb *</label>
                  <select id="verb" name="verb" class="form-select" required></select>

                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label class="form-label">VBE Phrase Style</label>
                      <select id="vbe_style" name="vbe_style" class="form-select">
                        <option value="guided" selected>guided by …</option>
                        <option value="accordance">in accordance with …</option>
                        <option value="aligned">aligned with …</option>
                      </select>
                    </div>

                    <div class="col-md-6 form-check" style="padding-top: 34px;">
                      <input class="form-check-input" type="checkbox" id="include_condition" checked>
                      <label class="form-check-label">Include condition</label>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <!-- CLO BUILDER -->
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <span class="icon-badge"><i class="bi bi-pencil"></i></span> CLO Builder
                </div>
                <div class="card-body">

                  <label class="form-label">Content *</label>
                  <input name="content" class="form-control" placeholder="e.g., ECG waveforms" required />

                  <div class="row mt-3">
                    <div class="col-md-4">
                      <label class="form-label">Condition</label>
                      <input id="condition" class="form-control" readonly />
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Criterion</label>
                      <input id="criterion" class="form-control" readonly />
                    </div>

                    <div class="col-md-4">
                      <label class="form-label">Assessment %</label>
                      <input type="number" name="cw" min="0" max="100" class="form-control" />
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <!-- ASSESSMENT -->
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <span class="icon-badge"><i class="bi bi-clipboard-check"></i></span> Assessment
                </div>
                <div class="card-body">

                  <label class="form-label">Assessment</label>
                  <input id="assessment" name="assessment" class="form-control" readonly />

                  <label class="form-label mt-3">Evidence</label>
                  <input id="evidence" name="evidence" class="form-control" readonly />

                </div>
              </div>
            </div>

            <!-- BUTTONS -->
            <div class="col-12 d-flex justify-content-between">
              <a href="{{ url_for('reset_table', profile=profile) }}" class="btn btn-outline-danger">
                Reset Table
              </a>

              <button type="submit" class="btn btn-primary">
                Generate CLO
              </button>
            </div>

          </div>
        </form>

        <!-- CLO PREVIEW -->
        <div class="card mt-4" id="cloPreviewCard" style="display:none;">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <span class="icon-badge"><i class="bi bi-lightbulb"></i></span> Generated CLO
            </div>

            <button id="copyCloBtn" class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-clipboard"></i> Copy
            </button>
          </div>

          <div class="card-body">
            <p id="cloPreviewText"></p>
            <hr>
            <div class="fw-semibold">Other options:</div>
            <div id="altOptions"></div>
          </div>
        </div>

        <!-- RUBRIC PREVIEW -->
        <div class="card mt-4" id="rubricCard" style="display:none;">
          <div class="card-header">
            <span class="icon-badge"><i class="bi bi-list-check"></i></span> CLO Rubric
          </div>
          <div class="card-body">
            <table class="table table-bordered">
              <tr><th>Indicator</th><td id="r_indicator"></td></tr>
              <tr><th>Excellent</th><td id="r_excellent"></td></tr>
              <tr><th>Good</th><td id="r_good"></td></tr>
              <tr><th>Satisfactory</th><td id="r_satisfactory"></td></tr>
              <tr><th>Poor</th><td id="r_poor"></td></tr>
            </table>
          </div>
        </div>

      </div> <!-- end tab -->

      <!-- HISTORY TAB -->
      <div class="tab-pane fade" id="tabHistory">
        <div class="card mt-3">
          <div class="card-header">
            <span class="icon-badge"><i class="bi bi-clock-history"></i></span> CLO History
          </div>
          <div class="card-body">

            <div id="historyPlaceholder" class="text-muted text-center">
              History is hidden for privacy.
              <br>
              <button id="loadHistoryBtn" class="btn btn-outline-primary mt-2">Show</button>
            </div>

            <div id="historyArea" style="display:none;">
              <div id="historyHTML"></div>
            </div>

            <template id="serverTable">
              {{ table_html|safe if table_html else "" }}
            </template>

          </div>
        </div>
      </div>

    </div>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /* All JS remains the same as your version */
  </script>

  <footer class="text-center mt-5 mb-4" style="opacity:0.7;">
    <strong>SCLOG Generator</strong><br>
    Developed by Assoc. Prof. Dr. Hazwani Ahmad Yusof@Hanafi, Advanced Medical and Dental Institute, Universiti Sains Malaysia (USM)
  </footer>

</body>
</html>
